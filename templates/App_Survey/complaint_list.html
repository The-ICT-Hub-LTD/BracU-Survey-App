{% extends 'layouts/base.html' %} 
{% block span_block %} 
All Feedbacks 
{% endblock span_block %} 

{% block body_block %}

    <div class="card card-default">
      <div class="card-header">
        <h2>Students Feedback Table</h2>
      </div>
      <div class="card-body">
        <div class="collapse" id="collapse-data-tables">
          <pre class="language-html mb-4"></pre>
        </div>
        <table
          id="productsTable"
          class="table table-hover table-product"
          style="width: 100%"
        >
          <thead>
            <tr>
                <th>SL</th>
                <th>Student Name</th>
                <th>Student ID</th>
                <th>Feedback Details</th>
                <th>Images</th>
                <th>Status</th>
                <th>Issued</th>
                <th>Update</th>
                <th>View</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            {% for complain in complaints %}
            <tr id="complain-row-{{ complain.id }}">
                <td>{{ forloop.counter }}</td>
                <td>{{ complain.student_name }}</td>
                <td>{{ complain.student_id }}</td>
                <td  style="white-space: nowrap;overflow: hidden;text-overflow: ellipsis;">{{ complain.problem_details | truncatechars:20  }}</td>
                <td style="text-align: center;">
                    {% if complain.complain_image %}
                        <span class="mdi mdi-image-multiple large" style="cursor: pointer;" onclick="viewImage('{{ complain.complain_image.url }}')" ></span>
                    {% else %}
                        No image
                    {% endif %}
                </td>
                <td>{{ complain.feedback_status }}</td>
                <td>{{ complain.submitted_at }}</td>
                <td>
                    <a href="{% url 'App_Survey:edit_complain' complain.id %}" class="btn btn-primary btn-sm"  data-toggle="modal" data-target="#editModal" onclick="openEditModal({{ complain.id }})">Edit</a>
                </td>
                <td>
                    <a href="{% url 'App_Survey:resolve_complain' complain.id %}" class="btn btn-info btn-sm">View</a>
                </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>



<div class="modal fade" id="imageModal" tabindex="-1" role="dialog" aria-labelledby="imageModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="imageModalLabel">Feedback Image</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <img id="modalImage" src="" alt="Complaint Image" class="img-fluid" />
            </div>
        </div>
    </div>
</div>

<!-- Modal for Editing Complaint -->
<div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-labelledby="editModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
      <div class="modal-content">
          <div class="modal-header">
              <h5 class="modal-title" id="editModalLabel">Update Feedbacks</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
              </button>
          </div>
          <div class="modal-body">
              <div id="modalEditForm">
                  
              </div>
          </div>
      </div>
  </div>
</div>

<script>
    function viewImage(imageUrl) {
        document.getElementById('modalImage').src = imageUrl;
        $('#imageModal').modal('show');
    }

    function openEditModal(complainId) {
        $.ajax({
            url: "{% url 'App_Survey:edit_complain' 0 %}".replace(0, complainId),
            type: "GET",
            success: function(response) {
                $('#modalEditForm').html(response.html);
                $('#editModal').modal('hide');
            },
            error: function(xhr, status, error) {
                console.log("Error loading modal:", error);
            }
        });
    }
</script>

{% endblock %} 

